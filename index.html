<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#2d7a2d">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>TT Tracker</title>
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/icon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="/css/styles.css">
  <script>
    // Apply theme immediately to prevent flash of wrong theme
    (function() {
      var saved = localStorage.getItem('theme');
      var theme = saved || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      if (theme === 'dark') document.documentElement.setAttribute('data-theme', 'dark');
    })();
  </script>
</head>
<body>

<div class="app-wrapper">

  <!-- Header -->
  <header class="app-header">
    <div style="display:flex;align-items:center;gap:8px">
      <div class="app-header__title" style="position:relative">üèì TT Tracker<span class="sync-badge" id="sync-badge">0</span></div>
      <span id="version-badge" style="font-size:10px;color:rgba(255,255,255,0.5);font-weight:400;display:none"></span>
    </div>
    <div style="display:flex;align-items:center;gap:8px">
      <button class="theme-toggle" id="lang-toggle-btn" aria-label="Toggle language" style="font-size:12px;font-weight:700">EN</button>
      <button class="theme-toggle" id="export-btn" aria-label="Export data" title="Export data">&#8615;</button>
      <button class="theme-toggle" id="theme-toggle-btn" aria-label="Toggle dark mode">üåô</button>
      <button id="users-btn" aria-label="Manage users" style="display:none;background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.3);color:#fff;border-radius:50%;width:32px;height:32px;font-size:16px;cursor:pointer;padding:0;line-height:1">&#9881;</button>
      <button id="change-pw-header-btn" class="theme-toggle" aria-label="Change password" title="Change password" style="display:none">&#128274;</button>
      <form method="POST" action="/logout" style="margin:0">
        <button type="submit" style="background:rgba(255,255,255,0.15);border:1px solid rgba(255,255,255,0.3);color:#fff;border-radius:20px;padding:6px 14px;font-size:13px;font-weight:600;cursor:pointer;font-family:inherit">Sign out</button>
      </form>
    </div>
  </header>

  <!-- Offline banner -->
  <div class="offline-banner" id="offline-banner"></div>

  <!-- Loading overlay -->
  <div class="loading-overlay active" id="loading-overlay"><div class="loading-spinner"></div></div>

  <!-- Tab Content -->
  <main class="tab-content">

    <!-- TAB: Home -->
    <section class="tab-panel active" id="tab-home">
      <div id="home-welcome"></div>
      <div id="home-recent-matches"></div>
      <div id="home-top-players"></div>
    </section>

    <!-- TAB: New Match -->
    <section class="tab-panel" id="tab-new-match">
      <div class="card card--padded">
        <div class="form-group">
          <label class="form-label">Players</label>
          <div class="doubles-toggle" id="doubles-toggle">
            <button class="doubles-toggle__btn doubles-toggle__btn--active" data-mode="singles">Singles</button>
            <button class="doubles-toggle__btn" data-mode="doubles">Doubles</button>
          </div>
          <div class="player-select-pair">
            <select class="form-select" id="player1-select" aria-label="Player 1"></select>
            <div class="vs-divider">VS</div>
            <select class="form-select" id="player2-select" aria-label="Player 2"></select>
          </div>
          <div class="doubles-extra" id="doubles-extra" style="display:none">
            <div class="player-select-pair">
              <select class="form-select" id="player3-select" aria-label="Player 3"></select>
              <div class="vs-divider">&amp;</div>
              <select class="form-select" id="player4-select" aria-label="Player 4"></select>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Sets</label>
          <div class="sets-container" id="sets-container"></div>
          <button class="btn btn--secondary mt-sm" id="add-set-btn">+ Add Set</button>
        </div>
        <div class="result-preview result-preview--neutral" id="result-preview">
          <div class="result-preview__label">Result</div>
          <div class="result-preview__text" id="result-preview-text">Select players &amp; enter scores</div>
        </div>
        <div class="form-group">
          <label class="form-label" for="match-note">Note (optional)</label>
          <input type="text" class="form-input" id="match-note" placeholder="e.g. Friendly game, tournament...">
        </div>
        <div class="form-group">
          <label class="form-label">Location (optional)</label>
          <div class="location-select-row">
            <select class="form-select" id="location-select" aria-label="Location"></select>
            <button type="button" class="btn btn--secondary btn--icon" id="detect-location-btn" title="Detect location">&#x1F4CD;</button>
          </div>
        </div>
        <button class="btn btn--primary" id="save-match-btn">Save Match</button>
      </div>
    </section>

    <!-- TAB: Players -->
    <section class="tab-panel" id="tab-players">
      <div class="section">
        <button class="btn btn--primary" id="add-player-btn">+ Add Player</button>
      </div>
      <div id="players-list"></div>
    </section>

    <!-- TAB: History -->
    <section class="tab-panel" id="tab-history">
      <div class="section">
        <select class="form-select" id="history-filter-select"></select>
      </div>
      <div id="history-list"></div>
    </section>

    <!-- TAB: Stats -->
    <section class="tab-panel" id="tab-stats">
      <div class="section">
        <select class="form-select" id="stats-filter-select"></select>
      </div>
      <div id="leaderboard-container"></div>
      <div id="player-stats-container"></div>
    </section>

    <!-- TAB: Locations -->
    <section class="tab-panel" id="tab-locations">
      <div class="section">
        <button class="btn btn--primary" id="add-location-btn">+ Add Location</button>
      </div>
      <div id="locations-list"></div>
    </section>

  </main>

  <!-- Bottom Navigation -->
  <nav class="bottom-nav">
    <button class="bottom-nav__item active" data-tab="home">
      <span class="bottom-nav__icon">
        <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
      </span>
      <span class="bottom-nav__label">Home</span>
    </button>
    <button class="bottom-nav__item" data-tab="new-match">
      <span class="bottom-nav__icon">
        <svg viewBox="0 0 24 24"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
      </span>
      <span class="bottom-nav__label">New</span>
    </button>
    <button class="bottom-nav__item" data-tab="players">
      <span class="bottom-nav__icon">
        <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
      </span>
      <span class="bottom-nav__label">Players</span>
    </button>
    <button class="bottom-nav__item" data-tab="history">
      <span class="bottom-nav__icon">
        <svg viewBox="0 0 24 24"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg>
      </span>
      <span class="bottom-nav__label">History</span>
    </button>
    <button class="bottom-nav__item" data-tab="stats">
      <span class="bottom-nav__icon">
        <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/></svg>
      </span>
      <span class="bottom-nav__label">Stats</span>
    </button>
    <button class="bottom-nav__item" data-tab="locations">
      <span class="bottom-nav__icon">
        <svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
      </span>
      <span class="bottom-nav__label">Places</span>
    </button>
  </nav>

</div>

<!-- Modal -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal" id="modal">
    <div class="modal__handle"></div>
    <div class="modal__header">
      <span class="modal__title" id="modal-title"></span>
      <button class="modal__close" id="modal-close-btn" aria-label="Close">‚úï</button>
    </div>
    <div class="modal__body" id="modal-body"></div>
    <div class="modal__footer" id="modal-footer"></div>
  </div>
</div>

<!-- Toast Container -->
<div id="toast-container"></div>

<script type="module" src="js/app.js"></script>
</body>
</html>
